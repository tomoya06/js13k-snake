(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function i(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerpolicy&&(r.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?r.credentials="include":s.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(s){if(s.ep)return;s.ep=!0;const r=i(s);fetch(s.href,r)}})();let v=()=>{};function bt(e,t){let i=e.indexOf(t);if(i!=-1)return e.splice(i,1),!0}let S={};function D(e,t){S[e]=S[e]||[],S[e].push(t)}function O(e,...t){(S[e]||[]).map(i=>i(...t))}let m,P,V={get(e,t){return t=="_proxy"?!0:v}};function vt(){return m}function rt(){return P}function Ct(e,{contextless:t=!1}={}){if(m=document.getElementById(e)||e||document.querySelector("canvas"),t&&(m=m||new Proxy({},V)),!m)throw Error("You must provide a canvas element for the game");return P=m.getContext("2d")||new Proxy({},V),P.imageSmoothingEnabled=!1,O("init"),{canvas:m,context:P}}function Mt(e,t){let i=Math.sin(t),n=Math.cos(t);return{x:e.x*n-e.y*i,y:e.x*i+e.y*n}}function j(e,t,i){return Math.min(Math.max(e,i),t)}function kt(e){let{x:t=0,y:i=0,width:n,height:s}=e.world||e;return e.mapwidth&&(n=e.mapwidth,s=e.mapheight),e.anchor&&(t-=n*e.anchor.x,i-=s*e.anchor.y),n<0&&(t+=n,n*=-1),s<0&&(i+=s,s*=-1),{x:t,y:i,width:n,height:s}}class x{constructor(t=0,i=0,n={}){this.x=t,this.y=i,n._c&&(this.clamp(n._a,n._b,n._d,n._e),this.x=t,this.y=i)}add(t){return new x(this.x+t.x,this.y+t.y,this)}subtract(t){return new x(this.x-t.x,this.y-t.y,this)}scale(t){return new x(this.x*t,this.y*t)}normalize(t=this.length()){return new x(this.x/t,this.y/t)}dot(t){return this.x*t.x+this.y*t.y}length(){return Math.hypot(this.x,this.y)}distance(t){return Math.hypot(this.x-t.x,this.y-t.y)}angle(t){return Math.acos(this.dot(t)/(this.length()*t.length()))}clamp(t,i,n,s){this._c=!0,this._a=t,this._b=i,this._d=n,this._e=s}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?j(this._a,this._d,t):t}set y(t){this._y=this._c?j(this._b,this._e,t):t}}function I(){return new x(...arguments)}class At{constructor(t){return this.init(t)}init(t={}){this.position=I(),this.velocity=I(),this.acceleration=I(),this.ttl=1/0,Object.assign(this,t)}update(t){this.advance(t)}advance(t){let i=this.acceleration;t&&(i=i.scale(t)),this.velocity=this.velocity.add(i);let n=this.velocity;t&&(n=n.scale(t)),this.position=this.position.add(n),this._pc(),this.ttl--}get dx(){return this.velocity.x}get dy(){return this.velocity.y}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}isAlive(){return this.ttl>0}_pc(){}}class Lt extends At{init({width:t=0,height:i=0,context:n=rt(),render:s=this.draw,update:r=this.advance,children:o=[],anchor:a={x:0,y:0},opacity:p=1,rotation:u=0,scaleX:h=1,scaleY:l=1,...d}={}){this._c=[],super.init({width:t,height:i,context:n,anchor:a,opacity:p,rotation:u,scaleX:h,scaleY:l,...d}),this._di=!0,this._uw(),this.addChild(o),this._rf=s,this._uf=r}update(t){this._uf(t),this.children.map(i=>i.update&&i.update(t))}render(){let t=this.context;t.save(),(this.x||this.y)&&t.translate(this.x,this.y),this.rotation&&t.rotate(this.rotation),(this.scaleX!=1||this.scaleY!=1)&&t.scale(this.scaleX,this.scaleY);let i=-this.width*this.anchor.x,n=-this.height*this.anchor.y;(i||n)&&t.translate(i,n),this.context.globalAlpha=this.opacity,this._rf(),(i||n)&&t.translate(-i,-n),this.children.map(r=>r.render&&r.render()),t.restore()}draw(){}_pc(){this._uw(),this.children.map(t=>t._pc())}get x(){return this.position.x}get y(){return this.position.y}set x(t){this.position.x=t,this._pc()}set y(t){this.position.y=t,this._pc()}get width(){return this._w}set width(t){this._w=t,this._pc()}get height(){return this._h}set height(t){this._h=t,this._pc()}_uw(){if(!this._di)return;let{_wx:t=0,_wy:i=0,_wo:n=1,_wr:s=0,_wsx:r=1,_wsy:o=1}=this.parent||{};this._wx=this.x,this._wy=this.y,this._ww=this.width,this._wh=this.height,this._wo=n*this.opacity,this._wsx=r*this.scaleX,this._wsy=o*this.scaleY,this._wx=this._wx*r,this._wy=this._wy*o,this._ww=this.width*this._wsx,this._wh=this.height*this._wsy,this._wr=s+this.rotation;let{x:a,y:p}=Mt({x:this._wx,y:this._wy},s);this._wx=a,this._wy=p,this._wx+=t,this._wy+=i}get world(){return{x:this._wx,y:this._wy,width:this._ww,height:this._wh,opacity:this._wo,rotation:this._wr,scaleX:this._wsx,scaleY:this._wsy}}set children(t){this.removeChild(this._c),this.addChild(t)}get children(){return this._c}addChild(...t){t.flat().map(i=>{this.children.push(i),i.parent=this,i._pc=i._pc||v,i._pc()})}removeChild(...t){t.flat().map(i=>{bt(this.children,i)&&(i.parent=null,i._pc())})}get opacity(){return this._opa}set opacity(t){this._opa=t,this._pc()}get rotation(){return this._rot}set rotation(t){this._rot=t,this._pc()}setScale(t,i=t){this.scaleX=t,this.scaleY=i}get scaleX(){return this._scx}set scaleX(t){this._scx=t,this._pc()}get scaleY(){return this._scy}set scaleY(t){this._scy=t,this._pc()}}class St extends Lt{init({image:t,width:i=t?t.width:void 0,height:n=t?t.height:void 0,...s}={}){super.init({image:t,width:i,height:n,...s})}get animations(){return this._a}set animations(t){let i,n;this._a={};for(i in t)this._a[i]=t[i].clone(),n=n||this._a[i];this.currentAnimation=n,this.width=this.width||n.width,this.height=this.height||n.height}playAnimation(t){this.currentAnimation=this.animations[t],this.currentAnimation.loop||this.currentAnimation.reset()}advance(t){super.advance(t),this.currentAnimation&&this.currentAnimation.update(t)}draw(){this.image&&this.context.drawImage(this.image,0,0,this.image.width,this.image.height),this.currentAnimation&&this.currentAnimation.render({x:0,y:0,width:this.width,height:this.height,context:this.context}),this.color&&(this.context.fillStyle=this.color,this.context.fillRect(0,0,this.width,this.height))}}function ot(){return new St(...arguments)}let Y=new WeakMap,R={},q={},ht={0:"left",1:"middle",2:"right"};function Pt(e,t){let{x:i,y:n,width:s,height:r}=kt(e);do i-=e.sx||0,n-=e.sy||0;while(e=e.parent);let o=t.x-Math.max(i,Math.min(t.x,i+s)),a=t.y-Math.max(n,Math.min(t.y,n+r));return o*o+a*a<t.radius*t.radius}function Dt(e){let t=e._lf.length?e._lf:e._cf;for(let i=t.length-1;i>=0;i--){let n=t[i];if(n.collidesWithPointer?n.collidesWithPointer(e):Pt(n,e))return n}}function f(e,t){return parseFloat(e.getPropertyValue(t))||0}function Ot(e){let{canvas:t,_s:i}=e,n=t.getBoundingClientRect(),s=i.transform!="none"?i.transform.replace("matrix(","").split(","):[1,1,1,1],r=parseFloat(s[0]),o=parseFloat(s[3]),a=(f(i,"border-left-width")+f(i,"border-right-width"))*r,p=(f(i,"border-top-width")+f(i,"border-bottom-width"))*o,u=(f(i,"padding-left")+f(i,"padding-right"))*r,h=(f(i,"padding-top")+f(i,"padding-bottom"))*o;return{scaleX:(n.width-a-u)/t.width,scaleY:(n.height-p-h)/t.height,offsetX:n.left+(f(i,"border-left-width")+f(i,"padding-left"))*r,offsetY:n.top+(f(i,"border-top-width")+f(i,"padding-top"))*o}}function tt(e){let t=e.button!=null?ht[e.button]:"left";q[t]=!0,N(e,"onDown")}function H(e){let t=e.button!=null?ht[e.button]:"left";q[t]=!1,N(e,"onUp")}function et(e){N(e,"onOver")}function Yt(e){let t=Y.get(e.target);t._oo=null,q={}}function it(e,t,i){let n=Dt(e);n&&n[t]&&n[t](i),R[t]&&R[t](i,n),t=="onOver"&&(n!=e._oo&&e._oo&&e._oo.onOut&&e._oo.onOut(i),e._oo=n)}function N(e,t){e.preventDefault();let i=e.target,n=Y.get(i),{scaleX:s,scaleY:r,offsetX:o,offsetY:a}=Ot(n);e.type.includes("touch")?(Array.from(e.touches).map(({clientX:u,clientY:h,identifier:l})=>{let d=n.touches[l];d||(d=n.touches[l]={start:{x:(u-o)/s,y:(h-a)/r}},n.touches.length++),d.changed=!1}),Array.from(e.changedTouches).map(({clientX:u,clientY:h,identifier:l})=>{let d=n.touches[l];d.changed=!0,d.x=n.x=(u-o)/s,d.y=n.y=(h-a)/r,it(n,t,e),O("touchChanged",e,n.touches),t=="onUp"&&(delete n.touches[l],n.touches.length--,n.touches.length||O("touchEnd"))})):(n.x=(e.clientX-o)/s,n.y=(e.clientY-a)/r,it(n,t,e))}function $t({radius:e=5,canvas:t=vt()}={}){let i=Y.get(t);if(!i){let n=window.getComputedStyle(t);i={x:0,y:0,radius:e,touches:{length:0},canvas:t,_cf:[],_lf:[],_o:[],_oo:null,_s:n},Y.set(t,i)}return t.addEventListener("mousedown",tt),t.addEventListener("touchstart",tt),t.addEventListener("mouseup",H),t.addEventListener("touchend",H),t.addEventListener("touchcancel",H),t.addEventListener("blur",Yt),t.addEventListener("mousemove",et),t.addEventListener("touchmove",et),i._t||(i._t=!0,D("tick",()=>{i._lf.length=0,i._cf.map(n=>{i._lf.push(n)}),i._cf.length=0})),i}function Bt(e,t){let i=e[0].toUpperCase()+e.substr(1);R["on"+i]=t}function Gt(e){let t=e.canvas;e.clearRect(0,0,t.width,t.height)}function Xt({fps:e=60,clearCanvas:t=!0,update:i=v,render:n,context:s=rt(),blur:r=!1}={}){if(!n)throw Error("You must provide a render() function");let o=0,a=1e3/e,p=1/e,u=t?Gt:v,h,l,d,B,M,G=!0;r||(window.addEventListener("focus",()=>{G=!0}),window.addEventListener("blur",()=>{G=!1}));function X(){if(l=requestAnimationFrame(X),!!G&&(d=performance.now(),B=d-h,h=d,!(B>1e3))){for(O("tick"),o+=B;o>=a;)M.update(p),o-=a;u(s),M.render()}}return M={update:i,render:n,isStopped:!0,start(){h=performance.now(),this.isStopped=!1,requestAnimationFrame(X)},stop(){this.isStopped=!0,cancelAnimationFrame(l)},_frame:X,set _last(Et){h=Et}},M}let C=[],U={},W={},at={0:"south",1:"east",2:"west",3:"north",4:"leftshoulder",5:"rightshoulder",6:"lefttrigger",7:"righttrigger",8:"select",9:"start",10:"leftstick",11:"rightstick",12:"dpadup",13:"dpaddown",14:"dpadleft",15:"dpadright"};function It(e){C[e.gamepad.index]={pressedButtons:{},axes:{}}}function Ht(e){delete C[e.gamepad.index]}function Ft(){C.map(e=>{e.pressedButtons={},e.axes={}})}function Rt(){let e=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads:[];for(let t=0;t<e.length;t++){let i=e[t];if(!i)continue;i.buttons.map((s,r)=>{let o=at[r],{pressed:a}=s,{pressedButtons:p}=C[i.index],u=p[o];!u&&a?[U[i.index],U].map(h=>{var l;(l=h==null?void 0:h[o])==null||l.call(h,i,s)}):u&&!a&&[W[i.index],W].map(h=>{var l;(l=h==null?void 0:h[o])==null||l.call(h,i,s)}),p[o]=a});let{axes:n}=C[i.index];n.leftstickx=i.axes[0],n.leftsticky=i.axes[1],n.rightstickx=i.axes[2],n.rightsticky=i.axes[3]}}function Ut(){window.addEventListener("gamepadconnected",It),window.addEventListener("gamepaddisconnected",Ht),window.addEventListener("blur",Ft),D("tick",Rt)}function Wt(e,t,{gamepad:i,handler:n="gamepaddown"}={}){let s=n=="gamepaddown"?U:W;[].concat(e).map(r=>{isNaN(i)?s[r]=t:(s[i]=s[i]||{},s[i][r]=t)})}let K={},k,nt=!1,T={swipe:{touches:1,threshold:10,touchend({0:e}){let t=e.x-e.start.x,i=e.y-e.start.y,n=Math.abs(t),s=Math.abs(i);if(!(n<this.threshold&&s<this.threshold))return n>s?t<0?"left":"right":i<0?"up":"down"}},pinch:{touches:2,threshold:2,touchstart({0:e,1:t}){this.prevDist=Math.hypot(e.x-t.x,e.y-t.y)},touchmove({0:e,1:t}){let i=Math.hypot(e.x-t.x,e.y-t.y);if(Math.abs(i-this.prevDist)<this.threshold)return;let n=i>this.prevDist?"out":"in";return this.prevDist=i,n}}};function Kt(){nt||(nt=!0,D("touchChanged",(e,t)=>{Object.keys(T).map(i=>{var r,o;let n=T[i],s;(!k||k==i)&&t.length==n.touches&&[...Array(t.length).keys()].every(a=>t[a])&&(s=(o=(r=n[e.type])==null?void 0:r.call(n,t))!=null?o:"")&&K[i+s]&&(k=i,K[i+s](e,t))})}),D("touchEnd",()=>{k=0}))}function Tt(e,t){[].concat(e).map(i=>{K[i]=t})}let lt={},dt={},z={},_={Enter:"enter",Escape:"esc",Space:"space",ArrowLeft:"arrowleft",ArrowUp:"arrowup",ArrowRight:"arrowright",ArrowDown:"arrowdown"};function ct(e=v,t){e._pd&&t.preventDefault(),e(t)}function qt(e){let t=_[e.code],i=lt[t];z[t]=!0,ct(i,e)}function Nt(e){let t=_[e.code],i=dt[t];z[t]=!1,ct(i,e)}function zt(){z={}}function ut(){let e;for(e=0;e<26;e++)_["Key"+String.fromCharCode(e+65)]=String.fromCharCode(e+97);for(e=0;e<10;e++)_["Digit"+e]=_["Numpad"+e]=""+e;window.addEventListener("keydown",qt),window.addEventListener("keyup",Nt),window.addEventListener("blur",zt)}function ft(e,t,{handler:i="keydown",preventDefault:n=!0}={}){let s=i=="keydown"?lt:dt;t._pd=n,[].concat(e).map(r=>s[r]=t)}function st(e,t){return Object.values(t).includes(e)}function Jt(e){return Object.keys(T).some(t=>e.startsWith(t))}function Qt(e={}){ut();let t=$t(e.pointer);return Kt(),Ut(),{pointer:t}}function $(e,t,{gamepad:i,key:n}={}){[].concat(e).map(s=>{if(st(s,at))Wt(s,t,i);else if(Jt(s))Tt(s,t);else if(st(s,_))ft(s,t,n);else if(["down","up"].includes(s))Bt(s,t);else throw new TypeError(`"${s}" is not a valid input name`)})}function Zt(e,t){return[Math.floor(e*Math.random()),Math.floor(t*Math.random())]}const J=document.getElementById("game"),g=[20,20];J.width=g[0]*10;J.height=g[1]*10;const A=[g[0]*10,g[1]*10];Ct(J);ut();Qt();const w=[];let c=1,y=!0,F=0,E=.1,L=10;const b=ot({x:0,y:0,color:"green",width:10,height:10});function Q(){const e=`
  SCORE: ${w.length}
  SPEED: ${Math.floor(10/E)}
  `;document.getElementById("score").innerText=e}function Z(e){let t;e?t=e:t=pt();const i=ot({x:t[0],y:t[1],color:"red",width:10,height:10});w.unshift(i)}function pt(){const e=[w[0].x,w[0].y];switch(c){case 0:e[1]-=L;break;case 1:e[0]+=L;break;case 2:e[1]+=L;break;case 3:e[0]-=L;break}return e[0]>A[0]-10?e[0]=0:e[0]<0&&(e[0]=A[0]-10),e[1]>A[1]-10?e[1]=0:e[1]<0&&(e[1]=A[1]-10),e}function wt(){c===3||c===1||!y||(c=3,y=!1)}function yt(){c===3||c===1||!y||(c=1,y=!1)}function gt(){c===0||c===2||!y||(c=0,y=!1)}function mt(){c===0||c===2||!y||(c=2,y=!1)}function Vt(){E=Math.max(.02,E-.02),Q()}function jt(){E=Math.min(.18,E+.02),Q()}ft("g",()=>{Z()});$(["a","swipeleft"],wt);$(["d","swiperight"],yt);$(["w","swipeup"],gt);$(["s","swipedown"],mt);document.getElementById("btn-up").onclick=gt;document.getElementById("btn-left").onclick=wt;document.getElementById("btn-right").onclick=yt;document.getElementById("btn-down").onclick=mt;document.getElementById("btn-speedup").onclick=Vt;document.getElementById("btn-speeddown").onclick=jt;[].slice.call(document.getElementsByTagName("button")).forEach(e=>e.addEventListener("click",t=>{t.preventDefault()}));function te(){const e=pt();e[0]===b.x&&e[1]===b.y&&(Z(),xt());const t=w.pop();t.x=e[0],t.y=e[1],w.unshift(t),y=!0}function ee(){let e="";const t=new Set([""]);for(let i=0;i<=w.length-1;i++){const n=w[i],s=`${n.x},${n.y}`;if(i===0||s===e){n.color="#ff7d7d",e=s;continue}t.has(s)?n.color="#a10000":n.color="red",t.add(s)}}function ie(e){F+=e,!(F<E)&&(F=0,te(),ee())}function ne(){const e=new Set(w.map(t=>`${Math.floor(t.x/10)},${Math.floor(t.y/10)}`));if(e.size===g[0]*g[1])return _t.stop(),alert("Sorry but you must stop now"),[0,0];for(;;){const t=Zt(g[0],g[1]);if(!e.has(`${t[0]},${t[1]}`))return[t[0]*10,t[1]*10]}}function xt(){const e=ne();b.x=e[0],b.y=e[1],Q()}for(let e=0;e<3;e++)Z([0,0]);xt();let _t=Xt({update:function(e){w.forEach(t=>{t.update()}),b.update(),ie(e)},render:function(){w.forEach(e=>{e.render()}),b.render()}});_t.start();document.addEventListener("gesturestart",function(e){e.preventDefault()});
